<?xml version="1.0" encoding="utf-8"?><!DOCTYPE nta PUBLIC '-//Uppaal Team//DTD Flat System 1.1//EN' 'http://www.it.uu.se/research/group/darts/uppaal/flat-1_1.dtd'><nta><declaration>// Place global declarations here.

const int nPacT = 2; // number of pacT's
typedef int[0, nPacT-1] id_pacT;

// Define data for pacTs
const struct { int id, prio, x, y; } data[nPacT] = { 
	{0, 8, 5, 5}, 
	{1, 2, 8, 8}
};


broadcast chan needHelp[nPacT], cancelNeed[nPacT];
broadcast chan canHelp[nPacT], cancelHelp[nPacT];
chan becomeCaller[nPacT], becomeHelper[nPacT], becomeRemover[nPacT];
chan resetCallerRole[nPacT], resetHelperRole[nPacT];
chan helpRequest;
chan requestApproved, requestDenied, cancelRequest, requestTimeout;
broadcast chan helpArrived;
broadcast chan problemSolved;
chan prepareTask, prepareDone;


const int MAX_DISTANCE = 8; //km
int leaderPrio;
int xPos;
int yPos;

void putData(int pLeaderPrio, int pxPos, int pyPos) {
	leaderPrio = pLeaderPrio;
	xPos = pxPos;
	yPos = pyPos;
}

bool check(int pLeaderPrio, int pxPos, int pyPos){
	bool prioClear = leaderPrio &gt; pLeaderPrio;

	int dx = (pxPos-xPos);
	int dy = (pyPos-yPos);
	int dis = dx*dx + dy*dy;
	bool disClear = dis &lt; (MAX_DISTANCE*MAX_DISTANCE);

	return (prioClear &amp;&amp; disClear);
}
</declaration><template><name x="5" y="5">Synchronization</name><parameter>const id_pacT id</parameter><declaration>clock t0;
</declaration><location id="id0" x="-1024" y="-216"><name x="-1096" y="-248">CallerRole</name><label kind="invariant" x="-1096" y="-224">t0 &lt;= 120</label></location><location id="id1" x="-272" y="-216"><name x="-264" y="-248">HelperRole</name><label kind="invariant" x="-256" y="-232">t0 &lt;= 120</label></location><location id="id2" x="-648" y="72"><name x="-696" y="88">prepareRemover</name><label kind="invariant" x="-680" y="104">t0 &lt;= 15</label></location><location id="id3" x="-648" y="-64"><name x="-632" y="-72">RemoverRole</name></location><location id="id4" x="-848" y="-216"><name x="-888" y="-200">prepareCaller</name></location><location id="id5" x="-448" y="-216"><name x="-496" y="-200">prepareHelper</name></location><location id="id6" x="-648" y="-216"><name x="-640" y="-208">IDLE</name></location><init ref="id6"/><transition><source ref="id0"/><target ref="id6"/><label kind="synchronisation" x="-920" y="-328">cancelNeed[id]?</label><nail x="-976" y="-304"/><nail x="-768" y="-304"/></transition><transition><source ref="id1"/><target ref="id5"/><label kind="synchronisation" x="-424" y="-264">resetHelperRole[id]?</label><nail x="-360" y="-248"/></transition><transition><source ref="id0"/><target ref="id4"/><label kind="synchronisation" x="-1000" y="-264">resetCallerRole[id]?</label><nail x="-936" y="-240"/></transition><transition><source ref="id1"/><target ref="id6"/><label kind="guard" x="-472" y="-392">t0 &gt; 100</label><label kind="synchronisation" x="-472" y="-376">cancelHelp[id]!</label><nail x="-272" y="-352"/><nail x="-576" y="-352"/></transition><transition><source ref="id0"/><target ref="id6"/><label kind="guard" x="-928" y="-392">t0 &gt; 100</label><label kind="synchronisation" x="-928" y="-376">cancelNeed[id]!</label><nail x="-1024" y="-352"/><nail x="-736" y="-352"/></transition><transition><source ref="id0"/><target ref="id2"/><label kind="synchronisation" x="-1008" y="24">helpArrived?</label><label kind="assignment" x="-1008" y="40">t0 = 0</label><nail x="-1024" y="72"/></transition><transition><source ref="id4"/><target ref="id0"/><label kind="synchronisation" x="-992" y="-184">becomeCaller[id]?</label><label kind="assignment" x="-960" y="-168">t0 = 0</label><nail x="-936" y="-184"/></transition><transition><source ref="id1"/><target ref="id2"/><label kind="synchronisation" x="-352" y="24">helpArrived?</label><label kind="assignment" x="-352" y="40">t0 = 0</label><nail x="-272" y="72"/></transition><transition><source ref="id5"/><target ref="id1"/><label kind="synchronisation" x="-416" y="-184">becomeHelper[id]?</label><label kind="assignment" x="-384" y="-168">t0 = 0</label><nail x="-360" y="-184"/></transition><transition><source ref="id2"/><target ref="id3"/><label kind="guard" x="-712" y="-8">t0 &gt; 10</label><label kind="synchronisation" x="-712" y="8">becomeRemover[id]!</label></transition><transition><source ref="id6"/><target ref="id5"/><label kind="synchronisation" x="-584" y="-184">canHelp[id]?</label><nail x="-544" y="-184"/></transition><transition><source ref="id5"/><target ref="id6"/><label kind="synchronisation" x="-584" y="-256">cancelHelp[id]?</label><nail x="-544" y="-240"/></transition><transition><source ref="id4"/><target ref="id6"/><label kind="synchronisation" x="-800" y="-256">cancelNeed[id]?</label><nail x="-752" y="-240"/></transition><transition><source ref="id3"/><target ref="id6"/><label kind="synchronisation" x="-696" y="-144">problemSolved?</label></transition><transition><source ref="id6"/><target ref="id4"/><label kind="synchronisation" x="-784" y="-192">needHelp[id]?</label><nail x="-744" y="-192"/></transition></template><template><name>CallerRole</name><parameter>const id_pacT id, int myPrio, int xPos, int yPos</parameter><declaration>clock t0;</declaration><location id="id7" x="-200" y="-56"><name x="-184" y="-88">ResetRole</name><label kind="invariant" x="-184" y="-72">t0 &lt;= 5</label></location><location id="id8" x="104" y="40"><name x="120" y="32">approved</name><label kind="invariant" x="120" y="48">t0 &lt;= 5</label></location><location id="id9" x="104" y="-176"><name x="120" y="-200">waiting</name><label kind="invariant" x="120" y="-184">t0 &lt;= 15</label></location><location id="id10" x="-456" y="-176"><name x="-520" y="-208">NotCaller</name></location><location id="id11" x="-200" y="40"><name x="-232" y="56">called</name><label kind="invariant" x="-232" y="72">t0 &lt;= 90</label><label kind="comments">(in community)</label></location><location id="id12" x="-200" y="-176"><name x="-232" y="-232">requesting</name><label kind="invariant" x="-224" y="-216">t0 &lt;= 5</label></location><init ref="id10"/><transition><source ref="id7"/><target ref="id10"/><label kind="guard" x="-352" y="-104">t0 &gt; 2</label><label kind="synchronisation" x="-360" y="-88">cancelNeed[id]!</label><label kind="assignment" x="-352" y="-72">t0 = 0</label><nail x="-384" y="-56"/></transition><transition><source ref="id11"/><target ref="id7"/><label kind="guard" x="-256" y="-24">t0 &gt; 80</label><label kind="synchronisation" x="-264" y="-8">cancelRequest!</label><label kind="assignment" x="-256" y="8">t0 = 0</label></transition><transition><source ref="id9"/><target ref="id12"/><label kind="guard" x="-64" y="-152">t0 &gt;= 10</label><label kind="synchronisation" x="-88" y="-136">requestTimeout!</label><label kind="assignment" x="-56" y="-120">t0 = 0</label><nail x="-40" y="-152"/></transition><transition><source ref="id8"/><target ref="id11"/><label kind="guard" x="-72" y="-16">t0 &gt; 2</label><label kind="synchronisation" x="-104" y="0">becomeCaller[id]!</label><label kind="assignment" x="-72" y="16">t0 = 0</label></transition><transition><source ref="id9"/><target ref="id8"/><label kind="synchronisation" x="112" y="-80">requestApproved?</label><label kind="assignment" x="112" y="-64">t0 = 0</label></transition><transition><source ref="id9"/><target ref="id12"/><label kind="synchronisation" x="-88" y="-80">requestDenied?</label><nail x="-40" y="-80"/></transition><transition><source ref="id12"/><target ref="id9"/><label kind="guard" x="-88" y="-288">t0 &gt; 2</label><label kind="synchronisation" x="-88" y="-272">helpRequest!</label><label kind="assignment" x="-120" y="-256">putData(myPrio, xPos, yPos),
t0 = 0</label><nail x="-40" y="-224"/></transition><transition><source ref="id12"/><target ref="id10"/><label kind="synchronisation" x="-376" y="-240">cancelNeed[id]?</label><nail x="-328" y="-216"/></transition><transition><source ref="id11"/><target ref="id10"/><label kind="synchronisation" x="-416" y="16">helpArrived?</label><nail x="-456" y="40"/></transition><transition><source ref="id10"/><target ref="id12"/><label kind="synchronisation" x="-368" y="-144">needHelp[id]?</label><label kind="assignment" x="-352" y="-128">t0 = 0</label><nail x="-328" y="-144"/></transition></template><template><name>HelperRole</name><parameter>const id_pacT id, int myPrio, int xPos, int yPos</parameter><declaration>clock t0;</declaration><location id="id13" x="-1944" y="-872"><name x="-1960" y="-856">ResetRole</name><label kind="invariant" x="-1952" y="-840">t0 &lt;= 5</label></location><location id="id14" x="-1712" y="-1040"><name x="-1744" y="-1096">approved</name><label kind="invariant" x="-1744" y="-1080">t0 &lt;= 5</label></location><location id="id15" x="-2368" y="-1040"><name x="-2440" y="-1080">NotHelper</name></location><location id="id16" x="-2224" y="-1040"><name x="-2248" y="-1072">ready</name></location><location id="id17" x="-1488" y="-1040"><name x="-1472" y="-1056">travelToCaller</name><label kind="invariant" x="-1472" y="-1040">t0 &lt;= 70</label></location><location id="id18" x="-2032" y="-1040"><name x="-2056" y="-1096">checking</name><label kind="invariant" x="-2056" y="-1080">t0 &lt;= 10</label></location><init ref="id15"/><transition><source ref="id13"/><target ref="id16"/><label kind="guard" x="-2136" y="-912">t0 &gt; 2</label><label kind="synchronisation" x="-2160" y="-896">resetHelperRole[id]!</label><nail x="-2224" y="-872"/></transition><transition><source ref="id17"/><target ref="id13"/><label kind="synchronisation" x="-1600" y="-912">cancelRequest?</label><label kind="assignment" x="-1600" y="-896">t0 = 0</label><nail x="-1488" y="-872"/></transition><transition><source ref="id18"/><target ref="id16"/><label kind="synchronisation" x="-2184" y="-1136">requestTimeout?</label><nail x="-2128" y="-1120"/></transition><transition><source ref="id18"/><target ref="id14"/><label kind="guard" x="-2000" y="-1064">t0 &gt; 5 &amp;&amp; check(myPrio, xPos, yPos)</label><label kind="synchronisation" x="-1952" y="-1040">requestApproved!</label><label kind="assignment" x="-1928" y="-1024">t0 = 0</label></transition><transition><source ref="id14"/><target ref="id17"/><label kind="guard" x="-1648" y="-1064">t0 &gt; 2</label><label kind="synchronisation" x="-1672" y="-1040">becomeHelper[id]!</label><label kind="assignment" x="-1648" y="-1024">t0 = 0</label></transition><transition><source ref="id17"/><target ref="id15"/><label kind="guard" x="-2008" y="-1280">t0 &gt; 60</label><label kind="synchronisation" x="-2016" y="-1264">helpArrived!</label><nail x="-1488" y="-1240"/><nail x="-2368" y="-1240"/></transition><transition><source ref="id16"/><target ref="id15"/><label kind="synchronisation" x="-2336" y="-976">cancelHelp[id]?</label><nail x="-2296" y="-976"/></transition><transition><source ref="id15"/><target ref="id16"/><label kind="synchronisation" x="-2336" y="-1064">canHelp[id]?</label></transition><transition><source ref="id18"/><target ref="id16"/><label kind="guard" x="-2208" y="-960">t0 &gt; 5 &amp;&amp; !check(myPrio, xPos, yPos)</label><label kind="synchronisation" x="-2176" y="-944">requestDenied!</label><nail x="-2128" y="-960"/></transition><transition><source ref="id16"/><target ref="id18"/><label kind="synchronisation" x="-2168" y="-1064">helpRequest?</label><label kind="assignment" x="-2160" y="-1040">t0 = 0</label></transition></template><template><name>RemoverRole</name><parameter>const id_pacT id</parameter><declaration>clock t0;</declaration><location id="id19" x="272" y="-200"><name x="248" y="-232">PrepDone</name></location><location id="id20" x="272" y="-72"><name x="224" y="-56">partnerPrepDone</name><label kind="invariant" x="248" y="-40">t0 &lt;= 30</label></location><location id="id21" x="-176" y="-144"><name x="-192" y="-192">ready</name><label kind="invariant" x="-200" y="-176">t0 &lt;= 20</label></location><location id="id22" x="-368" y="-144"><name x="-456" y="-176">NotRemover</name></location><location id="id23" x="448" y="-136"><name x="464" y="-144">removeObject</name><label kind="invariant" x="464" y="-128">t0 &lt;= 70</label></location><location id="id24" x="56" y="-144"><name x="8" y="-192">TaskPrepared</name><label kind="invariant" x="24" y="-176">t0 &lt;= 30</label></location><init ref="id22"/><transition><source ref="id20"/><target ref="id23"/><label kind="guard" x="352" y="-104">t0 &gt; 25</label><label kind="synchronisation" x="336" y="-88">prepareDone!</label><label kind="assignment" x="352" y="-72">t0 = 0</label></transition><transition><source ref="id19"/><target ref="id23"/><label kind="synchronisation" x="328" y="-200">prepareDone?</label><label kind="assignment" x="368" y="-184">t0 = 0</label></transition><transition><source ref="id24"/><target ref="id19"/><label kind="guard" x="136" y="-224">t0 &gt; 25</label><label kind="synchronisation" x="128" y="-208">prepareDone!</label></transition><transition><source ref="id24"/><target ref="id20"/><label kind="synchronisation" x="120" y="-88">prepareDone?</label><label kind="assignment" x="144" y="-72">t0 = 0</label></transition><transition><source ref="id21"/><target ref="id24"/><label kind="synchronisation" x="-104" y="-104">prepareTask?</label><label kind="assignment" x="-80" y="-88">t0 = 0</label><nail x="-64" y="-104"/></transition><transition><source ref="id21"/><target ref="id24"/><label kind="guard" x="-96" y="-232">t0 &gt; 15</label><label kind="synchronisation" x="-104" y="-216">prepareTask!</label><label kind="assignment" x="-96" y="-200">t0 = 0</label><nail x="-64" y="-184"/></transition><transition><source ref="id22"/><target ref="id21"/><label kind="synchronisation" x="-344" y="-168">becomeRemover[id]?</label><label kind="assignment" x="-332" y="-144">t0 = 0</label></transition><transition><source ref="id23"/><target ref="id22"/><label kind="synchronisation" x="-72" y="-328">problemSolved?</label><nail x="448" y="-304"/><nail x="-368" y="-304"/></transition><transition><source ref="id23"/><target ref="id22"/><label kind="guard" x="-48" y="8">t0 &gt; 60</label><label kind="synchronisation" x="-64" y="24">problemSolved!</label><nail x="448" y="8"/><nail x="-368" y="8"/></transition></template><template><name>Cognitive</name><declaration>clock t0;</declaration><location id="id25" x="-328" y="-232"><name x="-338" y="-262">OneNeeds</name></location><location id="id26" x="-552" y="-232"><name x="-584" y="-264">ZeroHelps</name></location><location id="id27" x="-776" y="-232"><name x="-792" y="-272">start</name></location><init ref="id27"/><transition><source ref="id25"/><target ref="id27"/><label kind="synchronisation" x="-592" y="-144">problemSolved?</label><label kind="assignment" x="-592" y="-128">t0 = 0</label><nail x="-552" y="-144"/></transition><transition><source ref="id26"/><target ref="id25"/><label kind="guard" x="-504" y="-288">t0 &gt; 10</label><label kind="synchronisation" x="-504" y="-272">needHelp[0]!</label><label kind="assignment" x="-504" y="-256">t0 = 0</label></transition><transition><source ref="id27"/><target ref="id26"/><label kind="guard" x="-720" y="-288">t0 &gt; 10</label><label kind="synchronisation" x="-720" y="-272">canHelp[1]!</label><label kind="assignment" x="-720" y="-256">t0 = 0</label></transition></template><system>// Create role templates with data
CallerT(const int i) = CallerRole(data[i].id, data[i].prio, data[i].x, data[i].y);
HelperT(const int i) = HelperRole(data[i].id, data[i].prio, data[i].x, data[i].y);
RemovT(const int i) = RemoverRole(data[i].id);
SyncT(const int i) = Synchronization(data[i].id);

// Instantiate templates.
caller0 = CallerT(0);
helper0 = HelperT(0);
remover0 = RemovT(0);
synch0 = SyncT(0);

caller1 = CallerT(1);
helper1 = HelperT(1);
remover1 = RemovT(1);
synch1 = SyncT(1);

// List one or more processes to be composed into a system.
system  caller0, helper0, remover0, synch0, 
	caller1, helper1, remover1, synch1,
	Cognitive;</system></nta>